<mat-card class="result-card">
    <mat-card-header>
        <mat-card-title>
            <span *ngIf="parsedAgenda">{{ parsedAgenda.title }}</span>
            <span *ngIf="!parsedAgenda">Generated Agenda</span>
        </mat-card-title>
        <mat-card-subtitle *ngIf="parsedAgenda">{{ parsedAgenda.summary }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
        <!-- Single Day / Simple List -->
        <div *ngIf="parsedAgenda?.items && !parsedAgenda?.days" class="day-section">
            <mat-form-field appearance="outline" class="full-width-textarea">
                <mat-label>Agenda Description</mat-label>
                <textarea matInput [(ngModel)]="dayEditableContent[0]" rows="15"></textarea>
            </mat-form-field>

            <div class="day-actions">
                <button mat-stroked-button color="accent" (click)="refineDay(0)">
                    <mat-icon>auto_fix_high</mat-icon> Refine with AI
                </button>
            </div>
        </div>

        <!-- Multi-day -->
        <div *ngIf="parsedAgenda?.days">
            <div *ngFor="let day of parsedAgenda?.days; let i = index" class="day-section">
                <div class="day-header" *ngIf="parsedAgenda!.days!.length > 1">
                    <h3>Day {{ i + 1 }} - {{ day.date }}</h3>
                </div>

                <mat-form-field appearance="outline" class="full-width-textarea">
                    <mat-label>Day {{ i + 1 }} Description</mat-label>
                    <textarea matInput [(ngModel)]="dayEditableContent[i]" rows="15"></textarea>
                </mat-form-field>

                <div class="day-actions">
                    <button mat-stroked-button color="accent" (click)="refineDay(i)">
                        <mat-icon>auto_fix_high</mat-icon> Refine
                    </button>
                    <button mat-stroked-button color="primary" (click)="downloadDayIcs(i)"
                        *ngIf="parsedAgenda!.days!.length > 1">
                        <mat-icon>event</mat-icon> Download Day {{ i + 1 }} ICS
                    </button>
                </div>
            </div>
        </div>

        <!-- Raw Content Fallback -->
        <div *ngIf="!parsedAgenda && rawContent" class="raw-content">
            <pre>{{ rawContent }}</pre>
        </div>
    </mat-card-content>

    <mat-card-actions align="end">
        <button mat-stroked-button (click)="copyToClipboard()">
            <mat-icon>content_copy</mat-icon> Copy to Clipboard
        </button>
        <button mat-stroked-button color="primary" (click)="downloadIcs()">
            <mat-icon>event</mat-icon> Download All ICS
        </button>
    </mat-card-actions>